<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP Authentication</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Frosted glass background */
            background-color: #f0f4f8;
            background-image:
                radial-gradient(at 0% 0%, hsla(253, 100%, 75%, 0.2) 0px, transparent 50%),
                radial-gradient(at 100% 0%, hsla(339, 100%, 75%, 0.2) 0px, transparent 50%),
                radial-gradient(at 100% 100%, hsla(19, 100%, 75%, 0.2) 0px, transparent 50%),
                radial-gradient(at 0% 100%, hsla(212, 100%, 75%, 0.2) 0px, transparent 50%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Style for the 6 OTP input boxes */
        .otp-input {
            width: 3rem; /* 48px */
            height: 3.5rem; /* 56px */
            text-align: center;
            font-size: 1.5rem; /* 24px */
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            border-radius: 0.5rem; /* 8px */
            border: 1px solid #cbd5e1; /* slate-300 */
            background-color: #f8fafc; /* slate-50 */
            transition: all 0.3s;
        }

        .otp-input:focus {
            outline: none;
            border-color: #4f46e5; /* indigo-600 */
            box-shadow: 0 0 0 3px #c7d2fe; /* indigo-200 */
            background-color: white;
        }
        
        /* Hide number input arrows */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

    </style>
</head>
<body class="p-4">

    <div class="w-full max-w-md">
    
        <!-- Screen 1: Request OTP -->
        <div id="request-screen" class="bg-white/80 backdrop-blur-lg rounded-2xl shadow-xl p-8 transition-all duration-300">
            <h2 class="text-3xl font-extrabold text-center text-slate-900 mb-2">Account Login</h2>
            <p class="text-center text-slate-600 mb-8">
                We'll send a one-time code to your email or phone.
            </p>

            <form id="request-form">
                <div>
                    <label for="email-phone" class="text-sm font-semibold text-slate-700">Email or Phone Number</label>
                    <input type="text" id="email-phone"
                           class="w-full px-4 py-3 mt-2 border border-slate-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                           placeholder="sandeep@example.com"
                           required>
                </div>

                <button type="submit"
                        class="w-full flex justify-center py-3 px-4 mt-8 border border-transparent rounded-lg shadow-lg text-lg font-medium text-white bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-4 focus:ring-indigo-300 transition-all duration-300 transform hover:scale-105">
                    Send OTP
                </button>
            </form>
            <div class="text-center mt-6">
                <a href="index.html" class="text-sm font-medium text-indigo-600 hover:text-indigo-500 transition-colors">
                    &larr; See the Logic
                </a>
            </div>
        </div>

        <!-- Screen 2: Verify OTP -->
        <div id="verify-screen" class="bg-white/80 backdrop-blur-lg rounded-2xl shadow-xl p-8 transition-all duration-300 hidden">
            <h2 class="text-3xl font-extrabold text-center text-slate-900 mb-2">Verify Your Code</h2>
            <p class="text-center text-slate-600 mb-8">
                Enter the 6-digit code sent to <br>
                <strong id="user-identifier" class="font-bold text-slate-800"></strong>
            </p>

            <!-- 6-Digit OTP Input Area -->
            <div id="otp-inputs" class="flex justify-center gap-2 sm:gap-3 mb-6">
                <input type="number" class="otp-input" maxlength="1" pattern="[0-9]">
                <input type="number" class="otp-input" maxlength="1" pattern="[0-9]">
                <input type="number" class="otp-input" maxlength="1" pattern="[0-9]">
                <input type="number" class="otp-input" maxlength="1" pattern="[0-9]">
                <input type="number" class="otp-input" maxlength="1" pattern="[0-9]">
                <input type="number" class="otp-input" maxlength="1" pattern="[0-9]">
            </div>
            
            <!-- Hidden full input -->
            <input type="hidden" id="otp-full-input">

            <!-- Timer and Message Area -->
            <div class="h-16 mt-4 mb-6 text-center">
                <!-- Timer -->
                <div id="timer-display-auth" class="text-sm font-medium text-slate-500 h-5">
                    <!-- Timer text appears here -->
                </div>
                <!-- Message -->
                <div id="message-area-auth" class="flex items-center justify-center gap-2 p-3 rounded-lg text-center font-medium opacity-0 transition-all duration-300 scale-95 mt-2">
                    <!-- Icons will be injected by JS -->
                    <span id="message-text-auth"></span>
                </div>
            </div>

            <button id="resend-btn"
                    class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-sm font-medium text-white bg-gradient-to-r from-slate-500 to-slate-600 hover:from-slate-600 hover:to-slate-700 focus:outline-none focus:ring-4 focus:ring-slate-300 transition-all duration-300 transform hover:scale-105
                            disabled:opacity-50 disabled:cursor-not-allowed">
                Resend OTP
            </button>
            
            <div class="text-center mt-6">
                <a href="index.html" class="text-sm font-medium text-indigo-600 hover:text-indigo-500 transition-colors">
                    &larr; See the Logic
                </a>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const requestScreen = document.getElementById('request-screen');
        const verifyScreen = document.getElementById('verify-screen');
        const requestForm = document.getElementById('request-form');
        const emailPhoneInput = document.getElementById('email-phone');
        const userIdentifier = document.getElementById('user-identifier');
        const resendBtn = document.getElementById('resend-btn');
        const timerDisplay = document.getElementById('timer-display-auth');

        // OTP Inputs
        const otpInputsContainer = document.getElementById('otp-inputs');
        const otpInputs = [...otpInputsContainer.querySelectorAll('input')];
        const otpFullInput = document.getElementById('otp-full-input');
        
        // Message Area
        const messageArea = document.getElementById('message-area-auth');
        const messageText = document.getElementById('message-text-auth');
        
        // --- Icons (as strings) ---
        const iconSuccess = `<svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>`;
        const iconError = `<svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>`;
        const iconWarning = `<svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.332-.216 3.001-1.742 3.001H4.42c-1.526 0-2.493-1.669-1.743-3.001l5.58-9.92zM10 13a1 1 0 100-2 1 1 0 000 2zm-1-4a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd" /></svg>`;

        // --- State ---
        let currentOTP = null;
        let isVerified = false;
        let otpTimerInterval = null; 
        let otpExpiryTimeout = null;
        let verificationAttempts = 0;
        const maxAttempts = 3;
        let isResendBlocked = false;
        let resendTimerInterval = null;

        // --- Functions ---
        
        function clearTimers() {
            if (otpTimerInterval) clearInterval(otpTimerInterval);
            if (otpExpiryTimeout) clearTimeout(otpExpiryTimeout);
            otpTimerInterval = null;
            otpExpiryTimeout = null;
        }

        function clearResendTimer() {
            if (resendTimerInterval) clearInterval(resendTimerInterval);
            resendTimerInterval = null;
            isResendBlocked = false;
            resendBtn.disabled = false;
            resendBtn.textContent = 'Resend OTP';
        }

        function showMessage(text, type) {
            messageText.textContent = text;
            messageArea.classList.remove('bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'bg-yellow-100', 'text-yellow-800');
            
            let icon = '';
            if (type === 'success') {
                messageArea.classList.add('bg-green-100', 'text-green-800');
                icon = iconSuccess;
            } else if (type === 'error') {
                messageArea.classList.add('bg-red-100', 'text-red-800');
                icon = iconError;
            } else if (type === 'warning') {
                messageArea.classList.add('bg-yellow-100', 'text-yellow-800');
                icon = iconWarning;
            }
            messageArea.innerHTML = icon + `<span id="message-text-auth">${text}</span>`;
            messageArea.classList.remove('opacity-0', 'scale-95');
        }

        function clearMessage() {
            messageArea.classList.add('opacity-0', 'scale-95');
        }

        function resetOtpInputs() {
            otpInputs.forEach(input => {
                input.value = '';
                input.disabled = false;
            });
            otpFullInput.value = '';
        }

        // Main function to trigger sending/resending
        function sendOTP() {
            if (isResendBlocked) return;

            // 1. Reset state
            clearTimers();
            currentOTP = Math.floor(100000 + Math.random() * 900000).toString();
            isVerified = false;
            verificationAttempts = 0;

            // 2. Reset UI
            resetOtpInputs();
            otpInputs.forEach(input => input.disabled = false);
            clearMessage();
            timerDisplay.classList.remove('text-red-600', 'text-green-600');
            timerDisplay.classList.add('text-slate-500');

            // 3. (Simulation) Log OTP to console
            console.warn(`(SIMULATION) OTP for ${emailPhoneInput.value} is: ${currentOTP}`);

            // 4. Start 60s expiry timer
            let expiryTimeLeft = 60;
            timerDisplay.textContent = `Expires in ${expiryTimeLeft}s`;

            otpTimerInterval = setInterval(() => {
                expiryTimeLeft--;
                timerDisplay.textContent = `Expires in ${expiryTimeLeft}s`;
            }, 1000);

            otpExpiryTimeout = setTimeout(() => {
                clearInterval(otpTimerInterval);
                currentOTP = null; // OTP is now invalid
                timerDisplay.textContent = 'OTP Expired';
                timerDisplay.classList.add('text-red-600');
                
                if (!isVerified && verificationAttempts < maxAttempts) {
                    showMessage('Your OTP has expired. Please request a new one.', 'warning');
                    otpInputs.forEach(input => input.disabled = true);
                }
            }, 60000); // 60 seconds

            // 5. Start 30s resend delay
            isResendBlocked = true;
            resendBtn.disabled = true;
            let resendTimeLeft = 30;
            resendBtn.textContent = `Resend available in ${resendTimeLeft}s`;
            
            resendTimerInterval = setInterval(() => {
                resendTimeLeft--;
                resendBtn.textContent = `Resend available in ${resendTimeLeft}s`;
                if (resendTimeLeft <= 0) {
                    clearResendTimer();
                }
            }, 1000);
            
            // 6. Auto-focus first input
            otpInputs[0].focus();
        }

        function handleVerifyOTP() {
            if (isVerified) return;

            const userInput = otpFullInput.value;

            if (verificationAttempts >= maxAttempts) {
                showMessage(`Too many failed attempts. Please request a new OTP.`, 'error');
                return;
            }

            if (!currentOTP) {
                showMessage('OTP is expired or not yet generated.', 'warning');
                return;
            }

            if (userInput === currentOTP) {
                // SUCCESS
                isVerified = true;
                clearTimers();
                showMessage('Verification Successful!', 'success');
                timerDisplay.textContent = 'Verified!';
                timerDisplay.classList.remove('text-slate-500', 'text-red-600');
                timerDisplay.classList.add('text-green-600');
                
                otpInputs.forEach(input => input.disabled = true);

            } else {
                // FAILURE
                verificationAttempts++;
                
                if (verificationAttempts >= maxAttempts) {
                    // Lock them out
                    showMessage(`Too many failed attempts (3/3). Please request a new OTP.`, 'error');
                    otpInputs.forEach(input => input.disabled = true);
                    clearTimers();
                    currentOTP = null;
                    timerDisplay.textContent = 'Verification Locked';
                    timerDisplay.classList.add('text-red-600');
                } else {
                    // Show normal fail message
                    showMessage(`Verification Failed. (${verificationAttempts}/${maxAttempts} attempts). Try again.`, 'error');
                    
                    // Clear input
                    setTimeout(() => {
                        resetOtpInputs();
                        otpInputs[0].focus();
                    }, 1000);
                }
            }
        }

        // --- Event Listeners ---
        
        // Screen 1: Request Form
        requestForm.addEventListener('submit', (e) => {
            e.preventDefault();
            // Show verification screen
            userIdentifier.textContent = emailPhoneInput.value;
            requestScreen.classList.add('hidden');
            verifyScreen.classList.remove('hidden');
            
            // Send the first OTP
            sendOTP();
        });

        // Screen 2: Resend Button
        resendBtn.addEventListener('click', sendOTP);

        // Screen 2: OTP Input Box Logic
        otpInputsContainer.addEventListener('input', (e) => {
            const target = e.target;
            const value = target.value;
            
            // Only allow one digit
            if (value.length > 1) {
                target.value = value[0];
            }
            
            // Move to next input
            if (value && target.nextElementSibling) {
                target.nextElementSibling.focus();
            }

            // Combine all inputs
            otpFullInput.value = otpInputs.map(input => input.value).join('');

            // Auto-verify
            if (otpFullInput.value.length === 6) {
                handleVerifyOTP();
            }
        });

        // Handle Backspace
        otpInputsContainer.addEventListener('keydown', (e) => {
            const target = e.target;
            if (e.key === 'Backspace' && !target.value && target.previousElementSibling) {
                target.previousElementSibling.focus();
            }
        });

        // Handle pasting
        otpInputsContainer.addEventListener('paste', (e) => {
            e.preventDefault();
            const pasteData = e.clipboardData.getData('text');
            if (/^\d{6}$/.test(pasteData)) {
                otpInputs.forEach((input, index) => {
                    input.value = pasteData[index];
                });
                otpFullInput.value = pasteData;
                handleVerifyOTP();
            }
        });

    </script>
</body>
</html>

